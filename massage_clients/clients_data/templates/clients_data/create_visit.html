{% extends 'clients_data/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block form %}
<h1 class="mb-4">Add Visits</h1>
                        <form method="POST">
                          {% csrf_token %}
                              {{ formset.management_form }}
                                {% for form in formset %}
                                    {% if form.errors %}
                                        {% for error in form.errors %}
                                        <p>{{ error }}</p>

                                        {% endfor %}
                                    {% endif %}
                                    {% if form.non_field_errors %}
                                        {% for error in form.non_field_errors %}
                                        <p>{{ error }}</p>

                                        {% endfor %}
                                    {% endif %}

                            <div class="form-row">
                                <div class="form-group col-md-4 mb-0">
                                    {{ form.client|as_crispy_field }}
                                </div>
                                <div class="form-group col-md-3 mb-0">
                                    {{ form.visit_date|as_crispy_field }}
                                </div>
                                <div class="form-group col-md-3 mb-0">
                                    {{ form.visit_time|as_crispy_field }}
                                </div>
                            </div>
                            {% endfor %}
                            <div class="col-12 col-sm-12">
                                <div class="col-12">
                                     <button type="button" id="add-form-btn">Add Form</button>
                                    <button class="btn btn-primary w-100 py-3" type="submit">Add</button>
                                </div>
                            </div>
                        </form>

{% endblock %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const addFormBtn = document.getElementById('add-form-btn');
    const formsetContainer = document.getElementById('formset-container');
    const formsetCount = {{ formset.total_form_count }};

    addFormBtn.addEventListener('click', function() {
      const formIdx = formsetCount;
      const formHtml = `
        <div class="formset-form">
          <fieldset class="form-group">
            <legend>Form ${formIdx + 1}</legend>
            {{ formset.empty_form.as_p }}
          </fieldset>
        </div>
      `;
      formsetContainer.insertAdjacentHTML('beforeend', formHtml);
    });
  });
</script>